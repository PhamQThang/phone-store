generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int             @id @default(autoincrement())
  email          String          @unique
  password       String
  firstName      String
  lastName       String
  roleId         Int
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @default(now()) @updatedAt
  address        String?
  phoneNumber    String?
  orders         Order[]
  purchaseOrders PurchaseOrder[] @relation("CreatedBy")
  role           Role            @relation(fields: [roleId], references: [id])
}

model Role {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  users     User[]
}

model Supplier {
  id             String          @id @default(uuid())
  name           String
  address        String
  phone          String          @unique
  email          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @default(now()) @updatedAt
  purchaseOrders PurchaseOrder[]
}

model PurchaseOrder {
  id                   String                @id @default(uuid())
  supplierId           String
  importDate           DateTime              @default(now())
  totalCost            Int
  status               String                @default("Pending")
  note                 String?
  createdById          Int?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now()) @updatedAt
  createdBy            User?                 @relation("CreatedBy", fields: [createdById], references: [id])
  supplier             Supplier              @relation(fields: [supplierId], references: [id])
  purchaseOrderDetails PurchaseOrderDetail[]
}

model PurchaseOrderDetail {
  id                String           @id @default(uuid())
  importId          String
  productId         String
  colorId           String
  productIdentityId String?          @unique
  importPrice       Int
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @default(now()) @updatedAt
  imei              String?
  color             Color            @relation(fields: [colorId], references: [id])
  import            PurchaseOrder    @relation(fields: [importId], references: [id])
  product           Product          @relation(fields: [productId], references: [id])
  productIdentity   ProductIdentity? @relation(fields: [productIdentityId], references: [id])
}

model ProductIdentity {
  id                  String               @id @default(uuid())
  imei                String               @unique
  colorId             String
  productId           String
  isSold              Boolean              @default(false) @map("is_sold")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now()) @updatedAt
  orderDetail         OrderDetail?
  color               Color                @relation(fields: [colorId], references: [id])
  product             Product              @relation(fields: [productId], references: [id])
  purchaseOrderDetail PurchaseOrderDetail?

  @@index([imei], map: "idx_product_identity_imei")
}

model Product {
  id                   String                @id @default(uuid())
  name                 String
  slug                 String                @unique
  price                Int
  storage              Int
  ram                  Int
  screenSize           Float
  battery              Int
  chip                 String
  operatingSystem      String
  modelId              String
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now()) @updatedAt
  orderDetails         OrderDetail[]
  model                Model                 @relation(fields: [modelId], references: [id])
  productFiles         ProductFiles[]
  productIdentities    ProductIdentity[]
  purchaseOrderDetails PurchaseOrderDetail[]
}

model Model {
  id        String    @id @default(uuid())
  name      String
  slug      String
  brandId   String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now()) @updatedAt
  brand     Brand     @relation(fields: [brandId], references: [id])
  products  Product[]

  @@unique([name, brandId])
}

model Brand {
  id        String   @id @default(uuid())
  slug      String   @unique
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  models    Model[]
}

model Color {
  id                   String                @id @default(uuid())
  name                 String                @unique
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @default(now()) @updatedAt
  orderDetails         OrderDetail[]
  productIdentities    ProductIdentity[]
  purchaseOrderDetails PurchaseOrderDetail[]
}

model File {
  id           String         @id @default(uuid())
  url          String
  public_id    String         @unique
  file_type    String         @default("image")
  size         Int?
  uploaded_at  DateTime       @default(now())
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @default(now()) @updatedAt
  productFiles ProductFiles[]
  slides       Slide[]
}

model ProductFiles {
  productId String
  fileId    String
  isMain    Boolean  @default(false) @map("is_main")
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  file      File     @relation(fields: [fileId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])

  @@id([productId, fileId])
}

model Order {
  id           String        @id @default(uuid())
  userId       Int
  address      String
  status       String        @default("Pending")
  totalAmount  Int           @map("total_amount")
  note         String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @default(now()) @updatedAt
  user         User          @relation(fields: [userId], references: [id])
  orderDetails OrderDetail[]
}

model OrderDetail {
  id                String          @id @default(uuid())
  orderId           String
  productId         String
  colorId           String
  productIdentityId String          @unique
  price             Int
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @default(now()) @updatedAt
  color             Color           @relation(fields: [colorId], references: [id])
  order             Order           @relation(fields: [orderId], references: [id])
  product           Product         @relation(fields: [productId], references: [id])
  productIdentity   ProductIdentity @relation(fields: [productIdentityId], references: [id])
}

model Slide {
  id           String    @id @default(uuid())
  title        String?
  description  String?
  imageId      String
  link         String?
  isActive     Boolean   @default(true) @map("is_active")
  displayOrder Int       @default(0) @map("display_order")
  startDate    DateTime? @map("start_date")
  endDate      DateTime? @map("end_date")
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  image        File      @relation(fields: [imageId], references: [id])
}

model BlacklistToken {
  id        String   @id @default(uuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
}
